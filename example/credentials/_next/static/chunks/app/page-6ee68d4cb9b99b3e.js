(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{3655:function(e,t,n){var i={"./arbitrum.svg":[92269,2269],"./aurora.svg":[50211,211],"./avalanche.svg":[59741,9741],"./base.svg":[10730,730],"./celo.svg":[35970,5970],"./ethereum.svg":[83734,3734],"./fantom.svg":[12120,2120],"./optimism.svg":[18086,8086],"./palm.svg":[59003,9003],"./polygon.svg":[57826,7826],"./solana.svg":[51020,1020],"./xdc.svg":[29818,9818]};function r(e){if(!n.o(i,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],r=t[0];return n.e(t[1]).then(function(){return n(r)})}r.keys=function(){return Object.keys(i)},r.id=3655,e.exports=r},29005:function(){},45179:function(){},76251:function(){},31993:function(){},75477:function(){},33196:function(){},50787:function(){},38087:function(){},85338:function(){},4302:function(e,t,n){Promise.resolve().then(n.bind(n,25676))},16337:function(e,t,n){"use strict";var i,r=n(46385).Buffer,a=Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]},o=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},l=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function l(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,l)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});let s=n(23960),c=(i=n(28195))&&i.__esModule?i:{default:i},d=n(13451),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return o(t,e),t}(n(17994)),v=n(29388);class f{static create(e,t){return new f(e,t)}store(e){return l(this,void 0,void 0,function*(){var t;if((null===(t=this.options.signer)||void 0===t?void 0:t.type)===d.CredentialSignerType.WALLET){let t=this.newLexi();yield Promise.all(e.map(e=>this.makeLexiStorageRequest(e,t)));return}yield Promise.all(e.map(e=>this.makeUnencryptedStorageRequest(e)))})}makeUnencryptedStorageRequest(e){return l(this,void 0,void 0,function*(){let t=e.content.map(e=>r.from(e.blob).toString("base64")),n=this.createStoreCredentialRequest(e,e.content.map(u.omit(["blob"]))),i=yield this.identityStoreClient.storeCredential(n),a=t.map((e,t)=>Object.assign(Object.assign({},i.content[t]),{stringBlob:e}));yield this.uploadBlobsToStorage(a,e.credentialId)})}makeLexiStorageRequest(e,t){return l(this,void 0,void 0,function*(){let n=yield this.encryptBlobsAsJWEs(t,e.content),i=this.createEncryptedContentArray(e.content,n),r=this.createStoreCredentialRequest(e,i),a=yield this.identityStoreClient.storeCredential(r),o=n.map((e,t)=>Object.assign(Object.assign({},a.content[t]),{stringBlob:e.payload.ciphertext}));yield this.uploadBlobsToStorage(o,e.credentialId)})}encryptBlobsAsJWEs(e,t){return l(this,void 0,void 0,function*(){return Promise.all(t.map(t=>l(this,void 0,void 0,function*(){return e.encryptForMe(t.blob)})))})}createEncryptedContentArray(e,t){return e.map((e,n)=>{let i=Object.assign(Object.assign({},t[n]),{payload:u.omit(["ciphertext"],t[n].payload)});return Object.assign(Object.assign({},u.omit(["blob"],e)),{encryptionMetadata:JSON.stringify(i)})})}createStoreCredentialRequest(e,t){return{credentialId:e.credentialId,tags:[...new Set([...e.tags,...e.content.map(e=>e.name)])],metadata:e.metadata,content:t,storageProvider:e.storageProvider||v.DEFAULT_STORAGE_PROVIDER}}uploadBlobsToStorage(e,t){return l(this,void 0,void 0,function*(){yield Promise.all(e.map(e=>l(this,void 0,void 0,function*(){return this.identityStoreClient.storeDataToStorage(t,e,e.stringBlob)})))})}find(e){return this.identityStoreClient.findCredentials(e)}get(e){return l(this,void 0,void 0,function*(){var t;let n=yield this.identityStoreClient.getCredential(e);if(!n)return null;if((null===(t=this.options.signer)||void 0===t?void 0:t.type)===d.CredentialSignerType.WALLET){let e=this.newLexi(),t=yield this.decryptContentArray(e,n.content);return Object.assign(Object.assign({},n),{content:t})}return Object.assign(Object.assign({},n),{content:yield this.retrieveContentArray(n.content)})})}decryptContentArray(e,t){return l(this,void 0,void 0,function*(){return Promise.all(t.map(t=>l(this,void 0,void 0,function*(){if("JWE"!==t.format)return t;if(!t.encryptionMetadata)throw Error("JWE content format but no encryption metadata!");if(!t.ref)throw Error("JWE content format without ref!");let n="string"==typeof t.encryptionMetadata?JSON.parse(t.encryptionMetadata):t.encryptionMetadata,i=yield this.identityStoreClient.getDataFromStorage(t);if(!i)throw Error("No ciphertext found in storage!");n.payload.ciphertext=i;let r=yield e.decrypt(n);return Object.assign(Object.assign({},u.omit(["encryptionMetadata","presignedUrl","ref"],t)),{blob:r})})))})}retrieveContentArray(e){return l(this,void 0,void 0,function*(){return Promise.all(e.map(e=>l(this,void 0,void 0,function*(){let t=yield this.identityStoreClient.getDataFromStorage(e);if(!t)throw Error("No content found in storage!");return Object.assign(Object.assign({},u.omit(["encryptionMetadata","presignedUrl","ref"],e)),{blob:r.from(t,"base64")})})))})}delete(e){return l(this,void 0,void 0,function*(){yield this.identityStoreClient.deleteCredential(e)})}newLexi(){return new s.LexiWallet(this.options.signer,this.did,Object.assign({publicSigningString:this.publicSigningString},this.options.lexi||{}))}constructor(e,t){this.did=e,this.options=t;let n=crypto.getRandomValues(new Uint8Array(32));this.publicSigningString=r.from(n).toString("base64"),this.identityStoreClient=new c.default(e,t.auth,t.identityStoreEndpoint)}}t.default=f},28195:function(e,t,n){"use strict";var i=n(46385).Buffer,r=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function l(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,l)}s((i=i.apply(e,t||[])).next())})},a=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_IDENTITY_STORE_ENDPOINT=void 0;let o=a(n(68200)),l=n(11974),s=a(n(68068));t.DEFAULT_IDENTITY_STORE_ENDPOINT="https://api.civic.com/identity-store/v2";class c{get evidenceAxiosInstance(){return this._evidenceAxiosInstance=o.default.create({}),this._evidenceAxiosInstance}getCredential(e){return r(this,void 0,void 0,function*(){return(yield this.axiosInstance.get("/credential/".concat(e))).data||null})}findCredentials(e){return r(this,void 0,void 0,function*(){return(yield this.axiosInstance.get("/credential",{params:{tags:e},validateStatus:function(e){return e>=200&&e<300||404===e}})).data})}storeCredential(e){return r(this,void 0,void 0,function*(){return(yield this.axiosInstance.post("/credential",e)).data})}getDataFromStorage(e){return r(this,void 0,void 0,function*(){if(!e.presignedUrl)throw Error("Trying to retrieve from undefined storage location!");let t=yield this.evidenceAxiosInstance.get(e.presignedUrl,{responseType:"arraybuffer"});return i.from(t.data,"binary").toString("base64")})}storeDataToStorage(e,t,n){return r(this,void 0,void 0,function*(){if(!t.presignedUrl)throw Error("Trying to store to undefined storage location!");let r=i.from(n,"base64");yield this.evidenceAxiosInstance.put(t.presignedUrl,r,{headers:{"Content-Type":"application/octet-stream"}});let a=s.default.createHash("sha256").update(r).digest("hex");t.ref=a,yield this.axiosInstance.patch("/credential/".concat(e,"/content"),{name:t.name,ref:t.ref})})}deleteCredential(e){return r(this,void 0,void 0,function*(){yield this.axiosInstance.delete("/credential/".concat(e))})}constructor(e,n,i=t.DEFAULT_IDENTITY_STORE_ENDPOINT){this.did=e,this.auth=n,this.endpoint=i,this.axiosInstance=o.default.create({baseURL:"".concat(this.endpoint,"/").concat(this.did),headers:{"x-civic-client-version":l.VERSION,Authorization:"Bearer ".concat(this.auth)}})}}t.default=c},29388:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_STORAGE_PROVIDER=void 0,t.DEFAULT_STORAGE_PROVIDER="civic-s3"},43699:function(e,t,n){"use strict";var i=Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.CredentialClient=void 0;var a=n(16337);Object.defineProperty(t,"CredentialClient",{enumerable:!0,get:function(){return(a&&a.__esModule?a:{default:a}).default}}),r(n(13451),t),r(n(29388),t)},13451:function(e,t){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.CredentialSignerType=void 0,(i=n||(t.CredentialSignerType=n={})).WALLET="WALLET",i.PASSKEY="PASSKEY"},11974:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="@civic/credential-client:0.1.1"},25676:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eu}});var i=n(27573),r=n(89350),a=n(92373),o=n(36818),l=n(75435),s=n(88103),c=n(67311),d=n(27401),u=n(3725),v=n(44866),f=n(7653),h=n(4562),p=n(5928),m=n(68173),g=n(12548),b=n(36630),y=n(10715),x=n(40552),j=n(60047),C=n(57702),w=n(61234),S=n(31839),E=n(95869),O=n(69113),N=n(17909),T=n(68632),A=n(65771),P=n(70378),_=n(31149),I=n(61901),D=n(16636);let M=[{...h.R,name:"Ethereum"},{...p.y,name:"Arbitrum"},{...m.y,name:"Polygon"},{...g.Q,name:"XDC"},{...b.Q,name:"Fantom"},{...y.m,name:"Polygon zkEVM"},{...x.p,name:"Avalanche"},{...j.u,name:"Base"},{...C.v,name:"Optimism"}],k=[{...w.F,name:"Sepolia"},{...S.w,name:"Goerli"},{...E.Z,name:"Arbitrum Sepolia"},{...O.v,name:"Polygon Mumbai"},{...N.A,name:"XDC Testnet"},{...T.P,name:"Fantom Testnet"},{...A.Y,name:"Polygon zkEVM Testnet"},{...P.c,name:"Avalanche Fuji"},{..._.L,name:"Base Sepolia"},{...I.O,name:"Optimism Sepolia"}],R=[{name:"Solana",rpcEndpoint:"https://virulent-silent-crater.solana-mainnet.quiknode.pro/f2077bcd064b0a8386774975fb35b18f1a1e6d6f/"}],L=[{name:"Solana Devnet",rpcEndpoint:"https://flashy-frosty-needle.solana-devnet.quiknode.pro/5b2ffc39b7ba4b592c3f0a8c92cd0df066a95838/"}];var F=n(77230),U=n(24717);let q=e=>{if(e&&!F.Z(e)){if(e.match(/^did:/))return e;if(e.match(/^(0x)/g))return"did:pkh:eip155:1:".concat((0,U.K)(e));if(function(e){try{return new D.PublicKey(e),!0}catch(e){return!1}}(e))return"did:sol:".concat(e)}};var B=n(88072),W=n(71060);let V=()=>({});function K(e){let{isOpen:t,onClose:n,title:r,contentClassName:a,withPadding:o,children:l,withOverlay:s=!0}=e;return t?(0,i.jsx)(B.u,{appear:!0,show:t,as:f.Fragment,children:(0,i.jsx)(W.Vq,{as:"div",onClose:n||V,children:(0,i.jsxs)(W.Vq.Panel,{className:"h-screen w-screen items-center justify-center overflow-y-auto overflow-x-hidden align-middle outline-none focus:outline-none",children:[r&&(0,i.jsx)(W.Vq.Title,{children:r}),(0,i.jsx)("div",{className:"absolute left-1/2 top-1/2 z-[102] mx-auto -translate-x-1/2 -translate-y-1/2 transform p-4 md:h-auto ".concat(a," w-full"),children:(0,i.jsxs)("div",{style:{backdropFilter:"blur(2rem)",borderRadius:"20px"},className:"shadow-[rgba(19, 21, 30, 0.65)] flex-col border-0 bg-gradient-to-tl from-backgroundGradientFrom to-quaternary shadow-2xl outline-none focus:outline-none ".concat(o?"p-12":""," text-textPrimary"),children:[n!==V&&(0,i.jsx)("button",{type:"button",className:"absolute right-6 top-6 ml-auto mr-1 mt-1 inline-flex cursor-pointer items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 outline-secondary hover:bg-gray-200 sm:right-2.5 sm:top-3",onClick:n,children:(0,i.jsx)("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),(0,i.jsx)("div",{children:l})]})})]})})}):null}K.defaultProps={contentClassName:"",title:void 0,withPadding:!0,withOverlay:!0,onClose:V};let J=f.createContext({});function z(e){let{children:t}=e,[n,l]=f.useState(!1),[s,c]=f.useState(!1),{openConnectModal:d}=(0,o.bL)(),{openConnectModal:u}=(0,a.F8)(),{data:v}=(0,o.py)(),{disconnect:h}=(0,o.qL)(),{connected:p,disconnect:m,chain:g}=(0,r.Os)(),[b,y]=(0,f.useState)(),{wallet:x}=(0,r.Os)(),j=(0,f.useMemo)(()=>{if((null==x?void 0:x.connected)&&x.publicKey)return l(!1),x},[x]),C=(0,f.useMemo)(()=>{if(v&&(null==v?void 0:v.account)&&(null==v?void 0:v.chain))return l(!1),v},[v]),w=(0,f.useMemo)(()=>{var e,t;return p?(null==j?void 0:j.publicKey)?q(j.publicKey.toBase58()):(null==C?void 0:null===(e=C.account)||void 0===e?void 0:e.address)?q(null==C?void 0:null===(t=C.account)||void 0===t?void 0:t.address):void 0:void 0},[j,C,p]),S=(0,f.useRef)(),E=(0,f.useRef)(),O=(0,f.useRef)(),N=(0,f.useCallback)(async e=>(y(e),c(!0),h(),await (null==j?void 0:j.disconnect().catch(e=>{console.error("solana disconnect error",e)})),l(!0),S.current=new Promise((e,t)=>{E.current=e,O.current=t}),S.current),[h,j]),T=(0,f.useCallback)(()=>{c(!1),l(!1),null==m||m()},[m]);(0,f.useEffect)(()=>{var e,t,n,i,r,a;if(C){if((null==b?void 0:b.onWalletConnectedValidation)&&!(null==b?void 0:b.onWalletConnectedValidation(C.account.address))){c(!1),null===(n=O.current)||void 0===n||n.call(O,Error("Invalid wallet"));return}c(!1),null===(t=E.current)||void 0===t||t.call(E,{...C,address:C.account.address});return}if(j&&(null===(e=j.publicKey)||void 0===e?void 0:e.toBase58())){if((null==b?void 0:b.onWalletConnectedValidation)&&!(null==b?void 0:b.onWalletConnectedValidation(null===(i=j.publicKey)||void 0===i?void 0:i.toBase58()))){c(!1),null===(a=O.current)||void 0===a||a.call(O,Error("Invalid wallet"));return}c(!1),null===(r=E.current)||void 0===r||r.call(E,{...j,address:j.publicKey.toBase58()})}},[C,b,j]);let A=g?g.toUpperCase():void 0,P=A&&Object.values(r.p0).includes(A)?r.p0[A]:void 0,_=(0,f.useMemo)(()=>{var e;return{did:w,address:w?null===(e=w.split(":"))||void 0===e?void 0:e.at(-1):void 0,connected:!!(p&&w),connectWallet:N,solanaWallet:j,evmWallet:C,disconnect:T,chain:g?P:void 0,isConnecting:s}},[P,g,p,w,T,C,N,j,s]),I=(0,f.useMemo)(()=>n,[n]),D=(0,f.useCallback)(()=>{var e;l(!1),null===(e=O.current)||void 0===e||e.call(O,Error("User closed modal"))},[]),M=(0,f.useCallback)(()=>{l(!1),null==d||d()},[d]),k=(0,f.useCallback)(()=>{l(!1),null==u||u()},[u]);return(0,i.jsxs)(J.Provider,{value:_,children:[(0,i.jsx)(K,{isOpen:I,onClose:D,withPadding:!1,contentClassName:"max-w-md",children:(0,i.jsxs)("div",{className:"p-8",children:[(0,i.jsx)("h4",{className:"profile-name-title my-5 text-center",children:"Choose chain type"}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{onClick:()=>k(),children:"Solana"})}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{onClick:()=>M(),children:"Ethereum (EVM) Compatible"})})]})}),t]})}let G=()=>(0,f.useContext)(J);var Y=n(68797),Q=n(44548),Z=n(6e3),H=n(83312),X=n(80640);let $=e=>{var t,n;let{account:i,chain:r,transport:a}=e,o={chainId:null==r?void 0:r.id,name:null==r?void 0:r.name,ensAddress:null==r?void 0:null===(n=r.contracts)||void 0===n?void 0:null===(t=n.ensRegistry)||void 0===t?void 0:t.address},l=new H.Q(a,o);return new X.C1(l,null==i?void 0:i.address)};var ee=n(49784);let et=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dev";return(await Z.Z.get("https://dev.api.civic.com/sign-".concat(e,"/nonce"))).data},en=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dev",{token:n}=(await Z.Z.request({method:"POST",url:"https://dev.api.civic.com/sign-".concat(t,"/authenticate"),data:{...e}})).data;return n},ei=(0,f.createContext)({});function er(e){let{children:t,stage:n="dev"}=e,[r,a]=(0,f.useState)(),{solanaWallet:o,evmWallet:l,connected:s,address:c}=G(),[d,u]=(0,f.useState)();(0,f.useEffect)(()=>{if(s&&o&&(null==o?void 0:o.publicKey)&&(null==o?void 0:o.signTransaction)){var e;console.log("useEffect wallet has changed, updating CivicSign proof",null==o?void 0:null===(e=o.publicKey)||void 0===e?void 0:e.toBase58()),u(Q.CivicSignProveFactory.createWithSolanaWallet({publicKey:null==o?void 0:o.publicKey,signTransaction:null==o?void 0:o.signTransaction,signMessage:null==o?void 0:o.signMessage},{cluster:"mainnet-beta",supportedClusterUrls:{"mainnet-beta":"https://twilight-small-flower.solana-mainnet.quiknode.pro/ec921b46257fea7637f4caed5780c80d49f4ab26/"},recentBlockCheck:!1,commitment:"confirmed",broadcastCheck:!1}))}else s&&l&&c?u(Q.CivicSignProveFactory.createWithEthereumWallet({address:c,signTypedData:(e,t,n)=>$(l).signTypedData(e,t,n),verifierAddress:""})):u(void 0)},[s,null==o?void 0:o.publicKey,u,o,l,c]);let v=(0,f.useCallback)(async()=>{if(s&&d&&c){let e="local"===n?"dev":n;console.log("proveOwnership");let t=async()=>{let t=await (null==d?void 0:d.requestDid());console.log("DID: ",t);let n=await et(e),i=await (null==d?void 0:d.requestProof(n.nonce));i&&t&&(console.log("powo proof",i.proof),a(await en({did:null==t?void 0:t.did,address:c,proof:i,chain:t.did.includes("sol")?"solana":"ethereum",nonceTimestamp:n.timestamp},e)))};ee.Am.promise(t(),{loading:"Attempting to authenticate with civic-sign",success:"Successfully authenticated with civic-sign",error:"Error when fetching"})}},[s,d,c,n]),h=(0,f.useMemo)(()=>({proveOwnership:v,auth:r}),[v,r]);return(0,i.jsx)(ei.Provider,{value:h,children:t})}let ea=()=>(0,f.useContext)(ei);var eo=n(43699);let el={local:"http://localhost:3000/local/v2",dev:"https://dev.api.civic.com/identity-store-dev/v2",preprod:"https://dev.api.civic.com/identity-store-preprod/v2",prod:"https://api.civic.com/identity-store/v2"};var es=n(46385).Buffer;let ec=["local","dev","preprod","prod"],ed=()=>{var e,t,n;let[r,a]=(0,f.useState)(""),[o,l]=(0,f.useState)(),[s,c]=(0,f.useState)(""),[d,u]=(0,f.useState)(""),{connectWallet:v,solanaWallet:h,evmWallet:p,connected:m,address:g,did:b,disconnect:y}=G(),[x,j]=(0,f.useState)("dev"),[C,w]=(0,f.useState)(el[x]),{proveOwnership:S,auth:E}=ea(),[O,N]=(0,f.useState)([]),[T,A]=(0,f.useState)([]),[P,_]=(0,f.useState)(0),[I,D]=(0,f.useState)([]),M=async e=>{e.target.files&&D(await Promise.all(Array.from(e.target.files).map(async e=>{let t=await e.arrayBuffer();return{file:e,credential:JSON.parse(es.from(t).toString("utf-8"))}})))},k=(0,f.useCallback)(e=>{e.target.files&&N([...Array.from(e.target.files),...O])},[O]);(0,f.useEffect)(()=>{if(r){let e=JSON.parse(r);c(e.id),u(e.identifier)}},[r]);let R=(0,f.useMemo)(()=>b&&E&&(h||p)?eo.CredentialClient.create(b,{identityStoreEndpoint:C,auth:E,signer:{type:eo.CredentialSignerType.WALLET,signMessage:async e=>{var t,n;if(h){let n=await (null==h?void 0:null===(t=h.signMessage)||void 0===t?void 0:t.call(h,e));if(!n)throw Error("No response from signMessage");return n}if(p){let t=await (null==p?void 0:null===(n=p.signMessage)||void 0===n?void 0:n.call(p,{message:{raw:e}}));if(!t)throw Error("No response from signMessage");return new Uint8Array(es.from(t))}throw Error("No wallet found")}}}):null,[b,E,h,p,C]);(0,f.useEffect)(()=>{R&&(ee.Am.loading("Discovering all existing credentials for ".concat(R.did)),R.find([]).then(e=>(A(e),ee.Am.dismiss(),ee.Am.success("".concat(e.length," Existing credentials found")))))},[R,P]);let L=(0,f.useCallback)(async e=>{let t=e||s;console.log("useCredentialId",t),R&&t&&(ee.Am.loading("Attempting to retrieve credential ".concat(t)),await R.get(t).then(e=>(ee.Am.dismiss(),e)?(l(e),ee.Am.success("Retrieved ".concat(e.credentialId," successfully"))):ee.Am.error("Couldn't retrieve credential")))},[R,s]),F=(0,f.useCallback)(async(e,t)=>{let n=[{name:e.identifier,mimeType:"application/json",format:"JWE",blob:es.from(JSON.stringify(e))}],i=async e=>{let t=new Uint8Array(await e.arrayBuffer()),n=new Uint8Array(es.from(t));console.log("evidenceContentFromFile buffer",{buffer:t,blob:n,name:e.name,type:e.type});let i=await crypto.subtle.digest("SHA-256",t).then(e=>es.from(e).toString("hex"));return console.log("evidenceContentFromFile buffer",{buffer:t,sha256:i}),{sha256:i,name:e.name,mimeType:e.type,format:"JWE",blob:n}},r=[...n,...t.length>0?await Promise.all(t.map(i)):[]];return{metadata:{issuanceDate:e.issuanceDate},credentialId:e.id,tags:[e.identifier,...r.map(e=>{let{name:t}=e;return t})],content:r}},[]),U=(0,f.useCallback)(async()=>{if(R&&I.length>0){let e=I.map(e=>{let{credential:t}=e;return t.id});console.log("store",e);let t=await Promise.all(I.map(e=>{let{credential:t}=e;return"credential-cvc:IdDocument-v3"===t.identifier?F(t,O):F(t,[])}));await ee.Am.promise(R.store(t).then(()=>{_(P+1)}),{loading:"Attempting to store ".concat(e),success:"Successfully stored ".concat(e),error:"Error when fetching"})}},[R,F,O,I,P]),q=(0,f.useCallback)(async e=>{R&&await ee.Am.promise(R.delete(e).then(()=>{_(P+1)}),{loading:"Attempting to delete ".concat(e),success:"Successfully deleted ".concat(e),error:"Error when deleting"})},[R,P]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"Stage:"}),ec.map(e=>(0,i.jsxs)("span",{children:[(0,i.jsx)("input",{type:"radio","data-testid":"TESTID_STAGE_".concat(e),value:e,name:"stage",checked:x===e,onChange:e=>{w(el[e.target.value]),j(e.target.value)}}),e]},"stage_".concat(e))),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsxs)("div",{children:["Identity Store endpoint:",(0,i.jsx)("input",{type:"text",onChange:e=>w(e.target.value),value:C,className:"resize rounded-md w-full"})]})]}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),!m&&(0,i.jsxs)("div",{className:"relative w-[32rem]",children:[(0,i.jsx)("div",{className:"text-xl font-bold",children:"MultiChain Connect"}),(0,i.jsx)("button",{onClick:()=>v(),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Connect wallet"})]}),m&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xl font-bold",children:"Wallet Connected"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:["Address: ",g]}),(0,i.jsxs)("div",{children:["DID: ",b]})]}),(0,i.jsx)("div",{className:"flex justify-start",children:(0,i.jsx)("button",{onClick:()=>null==S?void 0:S(),className:"bg-blue-500 hover:bg-grey-700 text-white font-bold py-2 px-4 rounded",children:"Authenticate with Civic-sign-backend"})}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)("button",{onClick:()=>null==y?void 0:y(),className:"bg-red-500 hover:bg-grey-700 text-white font-bold py-2 px-4 rounded",children:"Disconnect wallet"})})]}),E&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{children:"Existing credentials"}),(0,i.jsx)("ul",{className:"list-disc list-inside",children:T&&(null==T?void 0:T.map(e=>(0,i.jsxs)("li",{children:[(0,i.jsx)("a",{onClick:()=>L(e.credentialId),className:"text-blue-500 underline cursor-pointer",children:e.credentialId}),"\xa0",(0,i.jsxs)("span",{children:["Tags: [",e.tags.join(", "),"]"]}),(0,i.jsx)("button",{type:"button",onClick:()=>q(e.credentialId),className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",children:"Delete"})]},e.credentialId)))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"Upload Credential File(s)"}),(0,i.jsx)("input",{type:"file",multiple:!0,onChange:M,className:"mb-4"}),I&&I.length>0&&(0,i.jsx)("ul",{className:"list-disc list-inside",children:I.map((e,t)=>{let{file:n,credential:r}=e;return(0,i.jsxs)("li",{children:[r.id,", ",r.identifier,", ",n.name]},t)})})]}),(0,i.jsx)("br",{}),(0,i.jsxs)("div",{className:"relative w-[32rem]",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"Upload IDDocument Evidence Files"}),(0,i.jsx)("input",{type:"file",multiple:!0,onChange:k,className:"mb-4"}),O.map((e,t)=>(0,i.jsx)("div",{children:e.name},t))]}),(0,i.jsx)("div",{className:"flex w-full justify-between py-1.5",children:(0,i.jsx)("div",{className:"flex gap-2",children:I.length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("button",{onClick:U,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Store Credential"})})})})]}),s&&(0,i.jsxs)("div",{className:"relative w-[32rem]",children:[(0,i.jsx)("div",{children:"Retrieve credential"}),(0,i.jsx)("input",{type:"text",value:s,disabled:!0,className:"resize rounded-md w-full"}),(0,i.jsx)("button",{onClick:()=>L(),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Retrieve Credential"})]}),o&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{children:"Retrieved credential:"}),(0,i.jsxs)("div",{children:["tags: [",null==o?void 0:o.tags,"]"]}),(0,i.jsx)("div",{children:"content:"}),(0,i.jsx)("ul",{className:"list-disc list-inside",children:null==o?void 0:null===(e=o.content)||void 0===e?void 0:e.map(e=>(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:URL.createObjectURL(new Blob(["application/json"===e.mimeType?es.from(e.blob).toString():e.blob],{type:e.mimeType})),download:e.name,className:"text-blue-500 underline",children:[e.name," (",e.mimeType,")"]})},e.name))}),(0,i.jsxs)("form",{action:"/interaction/".concat(g,"/login"),method:"post",children:[(0,i.jsx)("input",{required:!0,type:"hidden",name:"credential",value:es.from(null==o?void 0:null===(n=o.content)||void 0===n?void 0:null===(t=n.at(0))||void 0===t?void 0:t.blob).toString()}),(0,i.jsx)("button",{type:"submit",children:"Sign-in"})]})]})]})]})};function eu(){let e=(0,f.useMemo)(()=>[new l.O,new s.e,new c.B,new d.Z({options:{projectId:"cb15f45a4b51799ebac3155e52fa5129"},network:R.length>0?v.Q.Mainnet:v.Q.Devnet}),new u.X],[]);return(0,i.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-between p-24",children:(0,i.jsx)(r.UU,{labels:{[r.iq.CONNECT]:"Connect",[r.iq.CONNECTED]:"Connected",[r.iq.DISCONNECT]:"Disconnect",[r.iq.DISCONNECTED]:"Disconnected",[r.iq.SELECT_CHAIN]:"Choose wallet type",[r.iq.OTHER]:"Other"},children:(0,i.jsx)(o.M$,{chains:M,testnetChains:k,providers:[(0,Y.I)()],options:{appName:"Civic.me",walletConnectProjectId:"".concat("cb15f45a4b51799ebac3155e52fa5129")},children:(0,i.jsx)(a.Mm,{adapters:e,chains:R,testnetChains:L,children:(0,i.jsx)(z,{children:(0,i.jsx)(er,{children:(0,i.jsx)(ed,{})})})})})})})}}},function(e){e.O(0,[7482,4901,2044,682,5608,9784,3156,1293,286,1744],function(){return e(e.s=4302)}),_N_E=e.O()}]);
//# sourceMappingURL=page-6ee68d4cb9b99b3e.js.map